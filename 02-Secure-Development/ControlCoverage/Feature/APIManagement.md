## IMPORTANT: DevOps Kit (AzSK) is being sunset by end of FY21. More details [here](.../ReleaseNotes/AzSKSunsetNotice.md)
----------------------------------------------

<html>
<head>

</head><body>
<H2>APIManagement</H2><table><tr><th>Description & Rationale</th><th>ControlSeverity</th><th>Automated</th></tr>
<tr><td><b>All users/identities must be granted minimum required permissions using Role Based Access Control (RBAC)</b><br/>Granting minimum access by leveraging RBAC feature ensures that users are granted just enough permissions to perform their tasks. This minimizes exposure of the resources in case of user/service account compromise.</td><td>Medium</td><td>Yes</td></tr><tr><td><b>Metric alert rules must be configured for critical actions on API Management service</b><br/>Metric alert for occurrence of unauthorized gateway requests help the admin to identify security breach attempts.</td><td>Medium</td><td>Yes</td></tr><tr><td><b>Diagnostics logs must be enabled with a retention period of at least 365 days</b><br/>Logs should be retained for a long enough period so that activity trail can be recreated when investigations are required in the event of an incident or a compromise. A period of 1 year is typical for several compliance requirements as well.</td><td>Medium</td><td>Yes</td></tr><tr><td><b>Backend API must only be accessible over HTTPS via API Management service</b><br/>Use of HTTPS ensures server/service authentication and protects data in transit from network layer eavesdropping attacks.</td><td>High</td><td>Yes</td></tr><tr><td><b>API Management service instance should be backed up periodically</b><br/>The service 'backup and restore' feature provides facility to recover from availability problems affecting the region where your API Management service is hosted.</td><td>Medium</td><td>No</td></tr><tr><td><b>'Named Values' that contain sensitive data must be encrypted by marking as 'secret'</b><br/>Encrypted 'Named Values' are stored securely by the Azure platform.</td><td>High</td><td>Yes</td></tr><tr><td><b>Ensure that only the most secure and up to date version of TLS is enabled on the API gateway</b><br/>TLS 1.2 is the latest and most secure protocol. Using 3DES Ciphers, TLS protocols (1.1 and 1.0) and SSL 3.0 exposes the API to meet-in-the-middle attack, chosen-plaintext or known-plaintext attacks.</td><td>High</td><td>No</td></tr><tr><td><b>Delete the two sample products 'Starter' and 'Unlimited' to avoid accidental exposure of APIs</b><br/>By default, each API Management instance comes with two sample products: Starter and Unlimited. Unless the access control of these sample products is being strictly regulated, associating APIs to these products stands the chance of exposing APIs to unauthenticated users.</td><td>Medium</td><td>Yes</td></tr><tr><td><b>Any header containing sensitive data such as authorization token should not be logged in Application Insights</b><br/>APIM provides an option to log request and response headers in Application Insights. Any header containing sensitive data such as authorization token should not be logged. This minimizes the risk of data loss from physical theft and also helps meet regulatory compliance requirements.</td><td>Medium</td><td>Yes</td></tr><tr><td><b>Ensure that CORS access is granted to a minimal set of trusted origins and only required verbs are supported</b><br/>CORS enables an operation or an API to allow cross-domain calls from browser-based clients. Using '*' (allow all) for CORS setting means that all cross-origin requests are allowed. Restricting allowed origins to the specific set that needs access aligns with the principle of least privilege.</td><td>Medium</td><td>Yes</td></tr><tr><td><b>If delegated authentication is enabled, ensure that it is implemented securely</b><br/>Delegation allows you to use your existing website for handling developer sign-in/sign-up and subscription to products as opposed to using the built-in functionality in the developer portal. It is the API publisher's responsibility to ensure protection of user data.</td><td>High</td><td>Yes</td></tr><tr><td><b>Consider hosting APIM within a virtual network for improved isolation</b><br/>Azure Virtual Network (VNet) deployment provides enhanced security and isolation for API management instance, as well as backend service, access control policies, and other features to further restrict access.</td><td>Medium</td><td>Yes</td></tr><tr><td><b>Custom domain with SSL binding must be configured for Proxy and Portal endpoints of Azure API Management instance</b><br/>Use of custom domain protects a backend service from common attacks such as phishing, session hijacking and other DNS-related attacks.</td><td>Medium</td><td>No</td></tr><tr><td><b>Ensure that JWT validation is enabled if using OAuth 2.0 or OpenID connect</b><br/>If 'validate-jwt' policy is not configured, client can call the API without the OAuth/OpenID connect authorization token. This policy enforces existence and validity of a JWT extracted from either a specified HTTP Header or a specified query parameter.</td><td>High</td><td>Yes</td></tr><tr><td><b>Use Restrict caller IPs policies for additional protection</b><br/>Using the IP filter policy feature ensures that access to the backend service is restricted to a specific set/group of clients. While this may not be feasible in all scenarios, when it can be used, it provides an extra layer of access control protection for critical assets.</td><td>Medium</td><td>Yes</td></tr><tr><td><b>Do not use API Management REST API</b><br/>The credentials used to access API Management REST API provide admin-level access without support for role-based access control and without recording audit logs. For better security it is recommended to make calls through the ARM-based REST API</td><td>High</td><td>Yes</td></tr><tr><td><b>Ensure that either OAuth 2.0 or OpenID Connect are used to authorize developer accounts in API Management</b><br/>Enabling OAuth/OpenID connect user authorization ensure that only valid users have access, and they can only access resources to which they are entitled.</td><td>High</td><td>Yes</td></tr><tr><td><b>Enterprise applications using APIM must authenticate developers/applications using Azure Active Directory backed credentials</b><br/>Using the native enterprise directory for authentication ensures that there is a built-in high level of assurance in the user identity established for subsequent access control. All Enterprise subscriptions are automatically associated with their enterprise directory (xxx.onmicrosoft.com) and users in the native directory are trusted for authentication to enterprise subscriptions.</td><td>High</td><td>Yes</td></tr><tr><td><b>Use transform policies to hide backend/implentation details in API responses</b><br/>Information such as technology stack that is running on the backend and the original URLs that appear in the body of API's HTTP response are private backend info and should be hidden from external customers.</td><td>Medium</td><td>No</td></tr><tr><td><b>Do not include secrets directly in API configuration and policies</b><br/>When using Git to save and configure your API Management service configuration, any secrets that are not defined as properties will be stored in the repository and will remain in its history until you disable and re-enable Git access. Properties (Named values) provide a secure place to manage constant string values, including secrets, across all API configuration and policies, so you don't have to store them directly in your policy statements.</td><td>High</td><td>Yes</td></tr><tr><td><b>Use client certificates for authentication between gateway and backend APIs</b><br/>Use client certificates to secure access to the back-end service of an API and protects data in transit from network layer man-in-the-middle, eavesdropping, session-hijacking attacks.</td><td>High</td><td>Yes</td></tr><tr><td><b>'Requires Subscription' option must be turned on for all products in an API Management instance</b><br/>When publishing APIs through Azure API Management (APIM), the easiest and most common way to secure access to the APIs is by using Subscription Keys. To obtain a Subscription Key for accessing APIs, a Subscription is required. This ensures that a Client applications that need to consume the published APIs must subscribe before making calls to those APIs.</td><td>High</td><td>Yes</td></tr><tr><td><b>Critical APIs must not be exposed to Guest users</b><br/>Guest users or unauthenticated developer portal users, such as prospective customers visiting the developer portal of an API Management instance can be granted certain read-only access, such as the ability to view APIs but not call them.</td><td>Medium</td><td>Yes</td></tr><tr><td><b>Use Managed Service Identity (MSI) for accessing other AAD-protected resources from the API management instance</b><br/>Managed Service Identity (MSI) allows your API Management instance to easily access other AAD-protected resources, such as Azure Key Vault. The identity is managed by the Azure platform and eliminates the need to provision/manage/rotate any secrets thus reducing the overall risk.</td><td>Medium</td><td>Yes</td></tr><tr><td><b>Use the 'Requires Approval' option for APIs where additional checks/manual review is necessary</b><br/>Enabling 'Requires Approval' ensures that only users approved by API publisher can subscribe to a product.</td><td>High</td><td>No</td></tr></table>
<table>
</table>
</body></html>
